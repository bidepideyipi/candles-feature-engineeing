```text
原始版本
[
    # 1-Hour Base Features (CORE PREDICTIVE FEATURES)
    close_1h_normalized,     # Normalized price (NOT raw timestamp)
    volume_1h_normalized,    # Normalized volume
    rsi_7_1h,                # Ultra-fast momentum (very sensitive)
    rsi_14_1h,               # Fast momentum (standard short-term)
    rsi_28_1h,               # Slow momentum (longer-term trend)
    macd_line_1h, macd_signal_1h, macd_histogram_1h,  # Trend following（12,26,9）
    
    # Time Context (CYCLICAL ENCODING)
    hour_cos, hour_sin,      # Cyclical time features (REPLACES raw timestamp)
    day_of_week,             # Weekly seasonality
    
    # 15-Minute High-Frequency Features
    rsi_7_15m,               # Immediate momentum reactions
    rsi_14_15m,               # Quick moves detection  
    rsi_28_15m,              # Short-term momentum
    macd_line_15m, macd_signal_15m, macd_histogram_15m,  # Trend following（12,26,9）
    volume_impulse_15m,      # Recent volume spikes（15分钟级别的成交量脉冲/激增指标）
    
    # 4-Hour Medium-Term Features  
    rsi_7_4h,               # Medium-term sensitivity
    rsi_14_4h,              # Standard medium-term
    rsi_28_4h,              # Longer medium-term trend
    macd_line_4h, macd_signal_4h, macd_histogram_4h,  # Trend following（12,26,9）
    trend_continuation_4h,  # Trend strength metric（趋势延续强度）
    
    # 1-Day Long-Term Context
    rsi_7_1d,              # Daily momentum
    rsi_14_1d,              # Multi-day trend
    rsi_28_1d,              # Extended trend analysis
    macd_line_1d, macd_signal_1d, macd_histogram_1d,  # Trend following（12,26,9）
    atr_1d,                 # Average True Range (volatility) 平均真实波幅
    support_distance_1d, resistance_distance_1d,  # Key levels
    
    # Cross-Timeframe Intelligence
    tf_momentum_confirmation,  # Do all timeframes agree?
    inter_tf_divergence,       # Contradictory signals across TFs
    multi_timeframe_score,     # Weighted trend consensus
    volatility_regime_1d,      # High/Low volatility state
    
    # Predictive Enhancements
    price_acceleration_1h,     # Rate of change
    volume_profile_1h,         # Volume distribution
    order_flow_imbalance,      # Buy/sell pressure
]
```

# MVP Feature Set (Minimum Viable Product)
### 1-Hour Base Layer (核心基础特征)
close_1h_normalized,    # 价格标准化
volume_1h_normalized,   # 成交量标准化
rsi_14_1h,              # 标准短期动量指标
macd_line_1h, macd_signal_1h,  # 趋势跟踪

### 时间编码 (替代时间戳)
hour_cos, hour_sin,     # 周期性时间特征
day_of_week,            # 周期性特征

### 15分钟高频特征 (短期信号)
rsi_14_15m,             # 快速动量反应
volume_impulse_15m,     # 成交量脉冲 (推荐20周期窗口)

### 4小时中期特征 (趋势确认)
rsi_14_4h,              # 中期动量
trend_continuation_4h,  # 趋势延续强度

```Text
    完成度100%，训练样本数1464；
    ============================================================
    训练结果摘要
    ============================================================
    准确率: 0.7031
    交叉验证准确率: 0.7148 (+/- 0.0510)
    训练时间: 2026-02-03T20:25:45.710812
    各类别置信度:
    类别 1: 0.7688
    类别 2: 0.6771
    类别 3: 0.5398
    类别 4: 0.5131
    类别 5: 0.5324
    类别 6: 0.6001
    类别 7: 0.8669
    ============================================================
```


# Version 1.0 Feature Set
### 1-Hour Base Layer (核心基础特征)
close_1h_normalized,    # 价格标准化
volume_1h_normalized,   # 成交量标准化
rsi_14_1h,              # 标准短期动量指标
macd_line_1h, macd_signal_1h,  # 趋势跟踪

### 时间编码 (替代时间戳)
hour_cos, hour_sin,     # 周期性时间特征
day_of_week,            # 周期性特征

### 15分钟高频特征 (短期信号)
rsi_14_15m,             # 快速动量反应
volume_impulse_15m,     # 成交量脉冲 (推荐20周期窗口)
macd_line_15m, macd_signal_15m,  # 趋势跟踪
atr_15m                 # 短期波动率（新增）
stoch_k_15m, stoch_d_15m  # 短期超买超卖（新增）

### 4小时中期特征 (趋势确认)
rsi_14_4h,              # 中期动量
trend_continuation_4h,  # 趋势延续强度
macd_line_4h, macd_signal_4h,  # 趋势跟踪
atr_4h                  # 4小时波动率（新增）
adx_4h, plus_di_4h, minus_di_4h  # 4小时趋势强度（新增）
ema_12_4h, ema_26_4h, ema_48_4h  # 4小时均线（新增）

### 1D框架（新增）
rsi_14_1d       # 日线动量
atr_1d          # 日线波动率

---

## Version 1.0 特征统计

### 特征分布
| 时间框架 | 特征数 | 特征列表 |
|---------|--------|---------|
| 1小时基础层 | 5 | close_1h_normalized, volume_1h_normalized, rsi_14_1h, macd_line_1h, macd_signal_1h |
| 时间编码 | 3 | hour_cos, hour_sin, day_of_week |
| 15分钟高频 | 7 | rsi_14_15m, volume_impulse_15m, macd_line_15m, macd_signal_15m, atr_15m, stoch_k_15m, stoch_d_15m |
| 4小时中期 | 10 | rsi_14_4h, trend_continuation_4h, macd_line_4h, macd_signal_4h, atr_4h, adx_4h, plus_di_4h, minus_di_4h, ema_12_4h, ema_26_4h, ema_48_4h |
| 1日线框架 | 2 | rsi_14_1d, atr_1d |

**总计：27 个特征**

### 新增特征对比 (从 MVP 到 Version 1.0)
| 类别 | MVP | Version 1.0 | 新增 |
|------|-----|-------------|------|
| 15分钟 | 2 | 7 | +5 (MACD, ATR, Stochastic) |
| 4小时 | 2 | 10 | +8 (MACD, ATR, ADX, +DI/-DI, 3 EMA) |
| 1日线 | 0 | 2 | +2 (RSI, ATR) |
| **总计** | **16** | **27** | **+11** |

### 新增技术指标说明

| 指标 | 计算器文件 | 用途 |
|------|-----------|------|
| ATR | atr_calculator.py | 波动率测量 |
| Stochastic | stoch_calculator.py | 超买超卖信号 |
| ADX | adx_calculator.py | 趋势强度 |
| +DI/-DI | adx_calculator.py (组合) | 趋势方向 |
| EMA | ema_calculator.py | 指数移动平均 |

```Text
    完成度100%，训练样本数12119；
    标签分布:
    1    1327
    2    2190
    3    1920
    4    1122
    5    1960
    6    2180
    7    1420
    ============================================================
    训练结果摘要
    ============================================================
    准确率: 0.6180
    交叉验证准确率: 0.5991 (+/- 0.0180)
    训练时间: 2026-02-04T20:16:28.554592
    各类别置信度:
    类别 1: 0.5452
    类别 2: 0.3603
    类别 3: 0.2946
    类别 4: 0.2606
    类别 5: 0.2822
    类别 6: 0.3772
    类别 7: 0.5827
    ============================================================
    参数调优建议:
    ============================================================
    ⚠️ 模型准确率较低
    建议: 检查特征质量，考虑增加更多特征

    最重要的 5 个特征:
    1. f27
    2. f7
    3. f26
    4. f25
    5. f24

    调整
    CLASSIFICATION_THRESHOLDS = {   
        1: (-100, -1.2),    
        2: (-1.2, 1.2),     
        3: (1.2, 100),       
    }
    后标签分布:
    1    3927
    2    4147
    3    4045
    ============================================================
    训练结果摘要
    ============================================================
    准确率: 0.8218
    交叉验证准确率: 0.8015 (+/- 0.0206)
    训练时间: 2026-02-04T21:14:14.350351
    各类别平均置信度:
    类别 1: 0.6379
    类别 2: 0.5431
    类别 3: 0.6489

    排名 7 类特征               3 类特征            变化 
    1   f27 (atr_1d)        f7 (day_of_week)    ↗ 上升 
    2   f7 (day_of_week)    f25 (ema_48_4h)     ↗ 上升 
    3   f26 (rsi_1d)        f26 (rsi_1d)        - 不变 
    4   f25 (ema_48_4h)     f27 (atr_1d)        ↘ 下降 
    5   f24 (ema_26_4h)     f24 (ema_26_4h)     - 不变
}
```
### 调整 XGBoost 参数
```json
params = {
    'objective': 'multi:softprob',
    'num_class': 3,
    'max_depth': 8,                    # 增加深度捕捉更复杂模式
    'learning_rate': 0.05,             # 降低学习率，增加迭代次数
    'subsample': 0.8,
    'colsample_bytree': 0.8,
    'random_state': 42,
    'eval_metric': 'mlogloss',
    'min_child_weight': 3,             # 防止过拟合
    'gamma': 0.1,                      # 最小分裂增益
    'reg_alpha': 0.1,                  # L1 正则化
    'reg_lambda': 1                    # L2 正则化
}
```

### 同时增加迭代次数
```json
self.model = xgb.train(
    params,
    dtrain,
    num_boost_round=300,              # 从 100 增加到 300
    evals=[(dtrain, 'train'), (dtest, 'test')],
    early_stopping_rounds=20,          # 从 10 增加到 20
    verbose_eval=False
)
```
```text
训练样本数13266；
标签分布:
1    4250
2    4706
3    4310
============================================================
训练结果摘要
============================================================
准确率: 0.8504
交叉验证准确率: 0.8206 (+/- 0.0205)
训练时间: 2026-02-05T13:54:39.225485
各类别置信度:
  类别 1: 0.7545
  类别 2: 0.6418
  类别 3: 0.7595

```

### 优先级 3：增加长期趋势特征
#### 在 feature_1D_creator.py 中新增
- bollinger_upper_1d  # 布林带上轨
- bollinger_lower_1d  # 布林带下轨
- bollinger_position_1d  # 布林带位置（价格在带内的相对位置）

####  在 feature_4h_creator.py 中新增
- ema_cross_4h  # EMA 交叉信号（12 vs 26, 26 vs 48）
- macd_histogram_4h  # MACD 柱状图（当前缺失）

### 优先级 4：特征工程优化
1. 归一化策略 ：当前只用均值-标准差归一化，考虑 Min-Max 归一化
2. 特征交互 ：添加 EMA 交叉信号、RSI 背离等组合特征
3. 滚动特征 ：添加过去 N 小时的涨跌幅、成交量变化率